var currentMapCenter;function initializeMap(e,o,t,a){e.width="auto"==e.width||"100%"==e.width?"100%":e.width+"px",e.height="auto"==e.height||"100%"==e.height?"100%":e.height+"px",document.getElementById(e.cavas_id).style.width=e.width,document.getElementById(e.cavas_id).style.height=e.height,""==e.owm_api&&(e.weather=!1);var r=GM.Base64.base64Decode(o),n=JSON.parse(r),l=(n.length,GM.Base64.base64Decode(t)),s=JSON.parse(l),p=Array();function m(e,o,t,a,r){if(1==e.enableStyle||"1"==e.enableStyle){for(var n=[],l=0;l<o.length;l++){var s={stylers:[]};"all"!=o[l].featureType&&(s.featureType=o[l].featureType),"all"!=o[l].elementType&&(s.elementType=o[l].elementType),"true"==o[l].invertLightness&&s.stylers.push({invert_lightness:!0}),o[l].visibility&&s.stylers.push({visibility:o[l].visibility}),o[l].mapColor&&s.stylers.push({color:o[l].mapColor}),o[l].weight&&s.stylers.push({weight:o[l].weight}),o[l].hue&&s.stylers.push({hue:o[l].hue}),o[l].saturation&&s.stylers.push({saturation:o[l].saturation}),o[l].lightness&&s.stylers.push({lightness:o[l].lightness}),o[l].gamma&&s.stylers.push({gamma:o[l].gamma}),n.push(s)}if("applyDefault"==e.createNewOrDefault)if(0!=n.length)var p={zoom:e.zoom,zoomControl:e.zoomControl,scaleControl:e.scaleControl,mapTypeControl:e.mapTypeControl,panControl:e.panControl,streetViewControl:e.streetViewControl,overviewMapControl:e.overviewMapControl,draggable:e.draggable,disableDoubleClickZoom:e.disableDoubleClickZoom,scrollwheel:e.scrollwheel,center:a,mapTypeId:e.mapType,styles:n};else p={zoom:e.zoom,zoomControl:e.zoomControl,scaleControl:e.scaleControl,mapTypeControl:e.mapTypeControl,panControl:e.panControl,streetViewControl:e.streetViewControl,overviewMapControl:e.overviewMapControl,draggable:e.draggable,disableDoubleClickZoom:e.disableDoubleClickZoom,scrollwheel:e.scrollwheel,center:a,mapTypeId:e.mapType};else{p={zoom:e.zoom,zoomControl:e.zoomControl,scaleControl:e.scaleControl,mapTypeControl:e.mapTypeControl,panControl:e.panControl,streetViewControl:e.streetViewControl,overviewMapControl:e.overviewMapControl,draggable:e.draggable,disableDoubleClickZoom:e.disableDoubleClickZoom,scrollwheel:e.scrollwheel,center:a,mapTypeControlOptions:{mapTypeIds:[e.mapType,"map_style"]}};var m=new google.maps.StyledMapType(n,{name:e.styleTitle})}}else p={zoom:e.zoom,zoomControl:e.zoomControl,scaleControl:e.scaleControl,mapTypeControl:e.mapTypeControl,panControl:e.panControl,streetViewControl:e.streetViewControl,overviewMapControl:e.overviewMapControl,draggable:e.draggable,disableDoubleClickZoom:e.disableDoubleClickZoom,scrollwheel:e.scrollwheel,center:a,mapTypeId:e.mapType};var c=new google.maps.Map(document.getElementById(e.cavas_id),p);for(1!=e.enableStyle&&"1"!=e.enableStyle||"createNew"!=e.createNewOrDefault||(c.mapTypes.set("map_style",m),c.setMapTypeId("map_style")),i=0;i<t.length;i++)g(e,t[i],c,r,i);currentMapCenter=c.getCenter(),google.maps.event.addDomListener(c,"idle",function(){currentMapCenter=c.getCenter()}),google.maps.event.addDomListener(window,"resize",function(){c.setCenter(currentMapCenter)})}function g(e,o,t,a,r){if("coordinate"==o.markerType){coordinate=o.markerValue.split(",");var n=new google.maps.LatLng(coordinate[0],coordinate[1]);e.weather?d(e,o,t,n,a,r):c(e,o,t,n,a,r)}else{(new google.maps.Geocoder).geocode({address:o.markerValue},function(n,l){if(l==google.maps.GeocoderStatus.OK){var s=n[0].geometry.location;e.weather?d(e,o,t,s,a,r):c(e,o,t,s,a,r)}else l==google.maps.GeocoderStatus.OVER_QUERY_LIMIT&&setTimeout(function(){g(e,o,t,a,r)},3e3)})}}function c(e,o,t,a,r,n){var l,s;if(e.weather&&o.weatherInfo&&e.replaceMarkerIcon?s=new google.maps.MarkerImage("http://openweathermap.org/img/w/"+o.weatherInfo.weather[0].icon+".png"):""==o.markerIcon?s="":(o.markerIcon=e.url+o.markerIcon,s={url:o.markerIcon}),l=(e.weather&&o.weatherInfo,new google.maps.Marker({position:a,map:t,icon:s,title:o.markerTitle,zIndex:10*n})),e.weather&&e.displayWeatherInfo&&o.weatherInfo&&(o.markerInfoWindow+='<p class="weather-info"><img src="http://openweathermap.org/img/w/'+o.weatherInfo.weather[0].icon+'.png" alt=""/><br/>'+o.weatherInfo.main.temp+"&deg;"+("c"==e.temperatureUnit?"C":"F")+"<br/>"+o.weatherInfo.weather[0].main+"</p>"),o.markerInfoWindow){if(1==e.enableCustomInfoBox||"1"==e.enableCustomInfoBox){var i=e.boxPosition.split(",");""==e.closeBoxImage&&(e.closeBoxImage="plugins/gemfourmedia/contacts/assets/images/close.gif");var m={content:o.markerInfoWindow,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(Number(i[0]),Number(i[1])),zIndex:10*n,boxStyle:r,closeBoxMargin:e.closeBoxMargin,closeBoxURL:e.url+"/"+e.closeBoxImage,infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1},g=new InfoBox(m)}else g=new google.maps.InfoWindow({content:o.markerInfoWindow});p.push(g),1==o.markerShowInfoWindow&&g.open(t,l),google.maps.event.addListener(l,"click",function(){for(var e=0;e<p.length;e++)p[e].close();g.open(t,l)})}}function d(e,o,t,a,r,n){var l="http://api.openweathermap.org/data/2.5/weather?lat="+a.lat()+"&lon="+a.lng()+"&cluster=yes&format=json"+("c"==e.temperatureUnit?"&units=metric":"")+"&APPID="+e.owm_api,s=new XMLHttpRequest;s.onload=function(){var l=JSON.parse(this.responseText);200==l.cod?o.weatherInfo=l:o.weatherInfo=!1,c(e,o,t,a,r,n)},s.open("get",l,!0),s.send()}!function(e,o,t,a){if("address"==e.mapCenterType&&""==e.mapCenterAddress||"coordinate"==e.mapCenterType&&""==e.mapCenterCoordinate)if(0==o.length){var r=new google.maps.Geocoder;r.geocode({address:"Ben Thanh Market"},function(r,n){if(n==google.maps.GeocoderStatus.OK)return mapCenter=r[0].geometry.location,m(e,t,o,mapCenter,a);alert("Geocode map center was not successful for the following reason: "+n)})}else{if("address"!=o[0].markerType)return mapCenterCoordinate=o[0].markerValue.split(","),mapCenter=new google.maps.LatLng(mapCenterCoordinate[0],mapCenterCoordinate[1]),m(e,t,o,mapCenter,a);var r=new google.maps.Geocoder;r.geocode({address:o[0].markerValue},function(r,n){if(n==google.maps.GeocoderStatus.OK)return mapCenter=r[0].geometry.location,m(e,t,o,mapCenter,a);alert("Geocode was not successful for the following reason: "+n+"! Map address: "+o[0].markerValue)})}else{if("address"!=e.mapCenterType)return mapCenterCoordinate=e.mapCenterCoordinate.split(","),mapCenter=new google.maps.LatLng(mapCenterCoordinate[0],mapCenterCoordinate[1]),m(e,t,o,mapCenter,a);var r=new google.maps.Geocoder;r.geocode({address:e.mapCenterAddress},function(r,n){if(n==google.maps.GeocoderStatus.OK)return mapCenter=r[0].geometry.location,m(e,t,o,mapCenter,a);alert("Geocode was not successful for the following reason: "+n+"! Map address: "+e.mapCenterAddress)})}}(e,n,s,a)}